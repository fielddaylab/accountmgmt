<html>
<head>
<link href="https://fonts.googleapis.com/css?family=Open+Sans:200,300,400,700" rel="stylesheet">
<style>
body,div,span
{
  margin:0px;
  padding:0px;
  color:blue;
  font:16px Open Sans;
}
img
{
  display:block;
}
body
{
  background-color:black;
}
td
{
  text-align:right;
}
.spacer
{

}
#middle_bar
{
  margin:0px auto;
  width:500px;
  height:100%;
  background-color:white;
}
#content
{

}
#brand
{

}
#tabs
{
  padding:10px;
}
.tab
{
  float:left;
  padding:2px 5px 0px 5px;
  border-top-left-radius:10px;
  border-top-right-radius:10px;
}
#sections
{
  clear:both;
  width:100%;
}
.section
{
  display:none;
  padding:10px;
}
.button
{
  margin:0px auto;
  width:50%;
  padding:8px;
  border:2px solid blue;
  border-radius:20px;
  text-align:center;
}
</style>
<script type="text/javascript">
function load()
{
  displaySection("auth");
  var params = parseURLParams(document.URL);
  if(params.username && params.password)
  {
    document.getElementById('auth_request_user').value = params.username;
    document.getElementById('auth_request_password').value = params.password;
    submitAuth();
  }
}

function displaySection(section)
{
  document.getElementById("auth_tab").style.borderTop       = "2px solid white";
  document.getElementById("auth_tab").style.borderLeft      = "2px solid white";
  document.getElementById("auth_tab").style.borderRight     = "2px solid white";
  document.getElementById("create_tab").style.borderTop     = "2px solid white";
  document.getElementById("create_tab").style.borderLeft    = "2px solid white";
  document.getElementById("create_tab").style.borderRight   = "2px solid white";
  document.getElementById("forgot_tab").style.borderTop     = "2px solid white";
  document.getElementById("forgot_tab").style.borderLeft    = "2px solid white";
  document.getElementById("forgot_tab").style.borderRight   = "2px solid white";
  document.getElementById(section+"_tab").style.borderTop   = "2px solid blue";
  document.getElementById(section+"_tab").style.borderLeft  = "2px solid blue";
  document.getElementById(section+"_tab").style.borderRight = "2px solid blue";

  document.getElementById("auth_section").style.display   = "none";
  document.getElementById("create_section").style.display = "none";
  document.getElementById("forgot_section").style.display = "none";
  document.getElementById(section+"_section").style.display = "block";
}

function parseURLParams(url) 
{
  var queryStart = url.indexOf("?") + 1;
  var queryEnd   = url.indexOf("#") + 1 || url.length + 1;
  var query      = url.slice(queryStart, queryEnd - 1);

  var params  = {};
  if (query === url || query === "") return params;
  var nvPairs = query.replace(/\+/g, " ").split("&");

  for(var i=0; i<nvPairs.length; i++)
  {
    var nv = nvPairs[i].split("=");
    var n  = decodeURIComponent(nv[0]);
    var v  = decodeURIComponent(nv[1]);
    if(!(n in params)) params[n] = [];
    params[n].push(nv.length === 2 ? v : null);
  }
  return params;
}

function sendRequest(fn, params, method)
{
  var xmlhttp;
  xmlhttp=new XMLHttpRequest();
  xmlhttp.open(method,"../../../json.php/v2."+fn,false);
  xmlhttp.setRequestHeader("Content-type", "application/json");
  xmlhttp.send(params); //Synchronous call

  return JSON.parse(xmlhttp.responseText);
}

var userId = 0;
var rwkey = "";
function submitAuth()
{
  var package = {"user_name":document.getElementById('auth_request_user').value,"password":document.getElementById('auth_request_password').value,"permission":"read_write"};
  var response = sendRequest('users.logIn', JSON.stringify(package), "POST");
  userId = response.data.user_id; document.getElementById('auth_response_user_id').innerHTML = response.data.user_id;
  rwkey = response.data.read_write_key; document.getElementById('auth_response_read_write_key').innerHTML = response.data.read_write_key;
}
function submitCreate()
{
  var package = {"user_name":document.getElementById('new_user_request_user').value,"password":document.getElementById('new_user_request_password').value};
  var response = sendRequest('users.createUser', JSON.stringify(package), "POST");
  document.getElementById('auth_request_user').value = document.getElementById('new_user_request_user').value;
  document.getElementById('auth_request_password').value = document.getElementById('new_user_request_password').value;
  userId = response.data.user_id; document.getElementById('auth_response_user_id').innerHTML = response.data.user_id;
  rwkey = response.data.read_write_key; document.getElementById('auth_response_read_write_key').innerHTML = response.data.read_write_key;
}

function submitCustom()
{
  var package = JSON.parse(document.getElementById('custom_request').value);
  package.auth = {"user_id":userId,"key":rwkey};
  var response = sendRequest(document.getElementById('custom_request_method').value, JSON.stringify(package), "POST");
}


/* NEEDS INTEGRATION
   function submitFix()
   {
   var p = parseURLParams(window.location.href);
   var p1 = document.getElementById('p1').value;
   var p2 = document.getElementById('p2').value;
   if(p1 != p2) {
   errorAlert("Passwords do not match.");
   return;
   }

   if(p1 === "") {
   warningAlert("Password can't be blank.");
   return;
   }

   var response = sendRequest('v2.users.fixPassword', {"user_id":p.i[0],"junk":p.j[0],"new_password":p1}, "POST");
   console.log(response);
   document.getElementById("content-area").innerHTML = "<h4>Your password was reset! Close this window and head back to ARIS to log in.</h4>";
   }

   function errorAlert(message) {
   document.getElementById('alert-box').innerHTML = "<div class='alert alert-danger' role='alert'><span class='glyphicon glyphicon-remove'></span> "+message+"</div>"
   }

   function warningAlert(message) {
   document.getElementById('alert-box').innerHTML = "<div class='alert alert-warning' role='alert'><span class='glyphicon glyphicon-question-sign'></span> "+message+"</div>"
   }
 */
</script>
</head>
<body onload="load()">

<div id="middle_bar">

  <div class="spacer" style="height:10%;"></div>
  <div id="content">

    <div id="brand">
      <img src="assets/arrow.png" style="margin:0px auto; width:10%;"></img>
      <div class="spacer" style="height:20px;"></div>
      <img src="assets/logo.png" style="margin:0px auto; width:80%;"></img>
    </div>

    <div class="spacer" style="height:30px;"></div>

    <div id="tabs">
      <div class="tab" id="auth_tab"   onclick='displaySection("auth")'  > Confirm Account </div>
      <div class="tab" id="create_tab" onclick='displaySection("create")'> Create Account  </div>
      <div class="tab" id="forgot_tab" onclick='displaySection("forgot")'> Forgot Password?</div>
    </div>

    <div class="spacer" style="height:30px;"></div>

    <div id="sections">

      <div class="section" id="auth_section">
          <table id="auth_inputs">
            <tr> <td>Username:</td> <td><input id='auth_request_user'     type='text'>    </input></td>  </tr>
            <tr> <td>Password:</td> <td><input id='auth_request_password' type='password'></input></td>  </tr>
          </table>
          <div class="spacer" style="height:30px;"></div>
          <div class="button" id='auth_request_submit' onclick='submitAuth()'>SIGN IN</div>
      </div>

      <div class="section" id="create_section">
          <table id="create_inputs">
            <tr> <td>Username:</td> <td><input id='create_request_user'     type='text'>    </input></td>  </tr>
            <tr> <td>Password:</td> <td><input id='create_request_password' type='password'></input></td>  </tr>
          </table>
          <div class="spacer" style="height:30px;"></div>
          <div class="button" id='create_request_submit' onclick='submitCreate()'>CREATE ACCOUNT</div>
      </div>

      <div class="section" id="forgot_section">
          <table id="forgot_inputs">
            <tr> <td>Username:</td> <td><input id='forgot_request_user'     type='text'>    </input></td> </tr>
            <tr> <td>Password:</td> <td><input id='forgot_request_password' type='password'></input></td> </tr>
          </table>
          <div class="spacer" style="height:30px;"></div>
          <div class="button" id='forgot_request_submit' onclick='submitForgot()'>SEND EMAIL</div>
      </div>

    </div>

  </div>

</div>

</body>
</html>

